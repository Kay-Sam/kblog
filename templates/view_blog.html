{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
    <div class="row">
        
        <!-- Main Content -->
        <div class="col-md-8">
            
            <!-- Blog Image -->
            {% if blog.image_filename %}
                <img src="{{ url_for('static', filename='uploads/' + blog.image_filename) }}"
                     alt="Blog Image"
                     class="blog-image-full mb-4">
            {% endif %}
            
            <!-- Blog Title -->
            <h2 class="mb-3">{{ blog.title }}</h2>
            
            <!-- Meta Info -->
            <p class="text-muted">
                <i class="fas fa-user"></i> {{ blog.user.username }} |
                <i class="fas fa-clock"></i> {{ blog.date_published.strftime('%B %d, %Y') }} |
                <a href="#comment" class="" style="font-size: 15px;">
        <i class="fas fa-comments"></i> {{ blog.comments|length }} comment{{ '' if blog.comments|length == 1 else 's' }}
                </a>
            </p>
            
            <!-- Category & Tags -->
            <p><strong>Category:</strong> {{ blog.category.name }}</p>
            <p><strong>Tags:</strong>
                {% for tag in blog.tags %}
                    <span class="badge bg-secondary">{{ tag.name }}</span>
                {% else %}
                    <span class="text-muted">No tags</span>
                {% endfor %}
            </p>
            
            <hr>
            
            <!-- Blog Description with Paragraphs -->
        <div class="blog-description mb-4" style="white-space: pre-wrap;">
            {{ blog.description | urlize(target="_blank") | safe }}
        </div>

            <hr>
            
            <!-- Comments -->
            <h4 class="mb-3" id="comment">Comments</h4>
            {% for comment in comments %}
                <div class="comment mb-3 p-3 bg-light rounded shadow-sm">
                    <strong>{{ comment.user.username }}:</strong> {{ comment.content }}
                    <br>
                    <small class="text-muted">
                        {{ comment.date_posted.strftime('%b %d, %Y %H:%M') }}
                    </small>
{% if session.get('user_id') == comment.user_id %}
<div class="mt-1">
    <a href="{{ url_for('edit_comment', comment_id=comment.id) }}" 
       class="text-primary" 
       style="display:inline-block; vertical-align:middle;">
       Edit 
    </a>
    |<form method="POST" action="{{ url_for('delete_comment', comment_id=comment.id) }}" style="display:inline-block; vertical-align:middle; margin-left:2px;">
        <button type="submit" class="text-danger btn btn-link p-0"
                onclick="return confirm('Are you sure you want to delete this comment?');">
             Delete
        </button>
    </form>
</div>

{% endif %}

                </div>
            {% else %}
                <p class="text-muted">No comments yet.</p>
            {% endfor %}
            
            <!-- Add Comment Form -->
            {% if user_id %}
                <form action="{{ url_for('add_comment', blog_id=blog.id) }}" method="POST" class="mt-4">
                    <div class="form-group">
                        <label for="content"><strong>Add Comment</strong></label>
                        <textarea name="content" class="form-control" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary mt-2">Post Comment</button>
                </form>
            {% else %}
                <p><a href="{{ url_for('login_page') }}">Log in</a> to post a comment.</p>
            {% endif %}
        
        </div>
        
        <!-- Sidebar -->
        <div class="col-md-4">
            {% include 'partials/sidebar.html' %}
        </div>
    
    </div>
</div>
{% endblock %}

